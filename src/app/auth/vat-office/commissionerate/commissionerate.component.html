<loading-image [is-loading]="isLoading"></loading-image>
<div class="row pt-5">

  <div class="d-flex">

    <div class="p-2 d-flex align-items-center">
      <h3 class="mb-0">Vat Office</h3>

    </div>


  </div>

</div>






<div class="row pt-4">


  <div class="accordion" id="commissionerateList"
    [ngStyle]="{ height: commissionerateList.length > 0 ? '600px' : 'auto', 'overflow-y': 'auto' }">
    <div class="accordion-item" *ngFor="let commissioner of commissionerateList" style="border-radius: 20px; margin-bottom: 20px; 
      
      ">


      <button [id]="'heading' + commissioner.code"
        style="background-color: #FFFFFF; display: flex; align-items: center; border-radius: 20px; padding-top: 10px; padding-bottom: 10px;"
        class="accordion-button" type="button" data-bs-toggle="collapse"
        [attr.data-bs-target]="'#collapseCommissioner' + commissioner.code"
        [attr.aria-controls]="'collapseCommissioner' + commissioner.code"
        [attr.aria-expanded]="currentlyOpenCommissionerId === commissioner.code"
        (click)="getDivisionList(commissioner.id); toggleCommissionerCollapse(commissioner.code)" [ngStyle]="{
            'border-radius': currentlyOpenCommissionerId === commissioner.code ? '20px 20px 0 0' : '20px'
        }">

        <div class="border-custom">
          <p class="code">Code : {{ commissioner.code }}</p>
        </div>

        <div class="border-cus">
          <p style="font-size: 18px; font-weight: bold;">Commisionerate {{ commissioner.id }}:</p>
          <p style="padding-left: 20px; font-size: 18px;">{{ commissioner.name }}</p>
        </div>

        <div *ngIf="currentlyOpenCommissionerId !== commissioner.code"
          class="d-flex align-items-center justify-content-center"
          style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); height: 54px; width: 54px; border-radius: 20px; background-color: #FFE5EC;">
          <!-- <i class="bi bi-search" style="font-size: 22px;"></i> -->
          <img src="assets/images/droparrow.svg" alt="VAT System Logo" class="img-fluid" style="transform: rotate(180deg);">
        </div>

        <div *ngIf="currentlyOpenCommissionerId === commissioner.code"
          class="d-flex align-items-center justify-content-center"
          style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); height: 54px; width: 54px; border-radius: 20px; background-color: #FFE5EC;">
          <img src="assets/images/droparrow.svg" alt="VAT System Logo" class="img-fluid">
        </div>
      </button>





      <div [id]="'collapseCommissioner' + commissioner.code" class="accordion-collapse collapse"
        [attr.aria-labelledby]="'heading' + commissioner.code" [attr.data-bs-parent]="'#commissionerateList'">

        <div class="accordion-body">

          <div class="accordion " [id]="'divisionList' + commissioner.code">

            <div class="timeline pr-4">



              <!-- Loop through timeline data dynamically -->
              <div class="tl-item" *ngFor="let division of divisionList">

                <!-- Dot -->
                <div class="tl-dot b-warning"></div>

                <!-- Content -->
                <div class="tl-content col" style="padding-left: 50px;">

                  <div class="accordion-item" style="border-radius: 20px;">




                    <button (click)="getCircleList(division.id, commissioner.id); toggleDivisionCollapse(division.code)"
                      style="background-color:  #FFFFFF; display: flex; align-items: center; border-radius: 20px; padding-top: 10px; padding-bottom: 10px;"
                      class="accordion-button" type="button" data-bs-toggle="collapse"
                      [attr.data-bs-target]="'#collapseDivision' + division.code"
                      [attr.aria-controls]="'collapseDivision' + division.code"
                      [attr.aria-expanded]="currentlyOpenDivisionId === division.code" [ngStyle]="{
    'border-radius': currentlyOpenDivisionId === division.code ? '20px 20px 0 0' : '20px'
  }">

                      <div class="border-custom">
                        <p class="code1">Code : {{ division.code }}</p>
                      </div>

                      <div class="border-cus">
                        <p style="font-size: 18px; font-weight: bold;">{{ division.name }}</p>
                      </div>

                      <div>
                        <button *ngIf="currentlyOpenDivisionId === division.code"
                          class="d-flex align-items-center justify-content-center"
                          style="width: 190px; position: absolute; right: 10%; top: 50%; transform: translateY(-50%); height: 54px; border-radius: 20px; background-color: #F6F6F6; color: #000000; font-size: 20px; font-weight: 400; border: 1px solid #00000033;">
                          <i class="bi bi-plus-lg" style="font-size: 30px;"></i> &nbsp; Add Circle
                        </button>
                      </div>

                      <div *ngIf="currentlyOpenDivisionId !== division.code"
                        class="d-flex align-items-center justify-content-center"
                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); height: 54px; width: 54px; border-radius: 20px; background-color: #FFECE5;">
                        <!-- <i class="bi bi-search" style="font-size: 22px;"></i> -->
                        <img src="assets/images/droparrow.svg" alt="VAT System Logo" class="img-fluid" style="transform: rotate(180deg);">
                      </div>

                      <div *ngIf="currentlyOpenDivisionId === division.code"
                        class="d-flex align-items-center justify-content-center"
                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); height: 54px; width: 54px; border-radius: 20px; background-color: #FFECE5;">
                        <img src="assets/images/droparrow.svg" alt="VAT System Logo" class="img-fluid">
                      </div>

                    </button>




                    <div [id]="'collapseDivision' + division.code" class="accordion-collapse collapse"
                      [attr.aria-labelledby]="'headingDivision' + division.code"
                      [attr.data-bs-parent]="'#divisionList' + commissioner.code">

                      <div class="accordion-body">

                        <div class="accordion" [id]="'circleList' + division.code">

                          <div class="timeline p-4">

                            <div class="tl-item" *ngFor="let circle of circleList">

                              <!-- Dot -->
                              <div class="tl-dot b-warning"></div>

                              <!-- Content -->
                              <div class="tl-content col" style="padding-left: 50px;">

                                <div class="accordion-item" style="border-radius: 20px;">



                                  <button
                                    style="background-color:  #FFFFFF; display: flex; align-items: center; border-radius: 20px; padding-top: 10px; padding-bottom: 10px;"
                                    class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    [attr.data-bs-target]="'#collapseCircle' + circle.code"
                                    [attr.aria-controls]="'collapseCircle' + circle.code"
                                    [attr.aria-expanded]="isCollapsed[circle.code] ? 'false' : 'true'"
                                    (click)="getTaxPayerList(circle.id , division.id, commissioner.id ); toggleCircleCollapse(circle.code)"
                                    [ngStyle]="{
                        'border-radius': isCollapsed[circle.code] ? '20px 20px 0 0' : '20px'
                      }">

                                    <div class="border-custom">
                                      <p class="code2">Code : {{ circle.code }} </p>
                                    </div>

                                    <div class="border-cus">
                                      <p style="font-size: 18px; font-weight: bold;">{{ circle.name }}</p>
                                    </div>


                                    <div *ngIf="currentlyOpenCircleId !==  circle.code"
                                      class="d-flex align-items-center justify-content-center"
                                      style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); height: 54px ; width: 54px; border-radius: 20px; background-color: #FFF4DE;">
                                      <!-- <i class="bi bi-search" style="font-size: 22px;"> </i> -->
                                      <img src="assets/images/droparrow.svg" alt="VAT System Logo" class="img-fluid" style="transform: rotate(180deg);">
                                    </div>

                                    <div *ngIf="currentlyOpenCircleId ===  circle.code"
                                      class="d-flex align-items-center justify-content-center"
                                      style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); height: 54px ; width: 54px; border-radius: 20px; background-color: #FFF4DE;">
                                      <img src="assets/images/droparrow.svg" alt="" class="img-fluid">

                                    </div>

                                  </button>



                                  <div [id]="'collapseCircle' + circle.code" class="accordion-collapse collapse"
                                    [attr.aria-labelledby]="'headingCircle' + circle.code"
                                    [attr.data-bs-parent]="'#circleList' + division.code"
                                    
                                    *ngIf="taxPayerList?.length > 0; else noData"
                                    >





                                    <table id="example">

                                      <thead>
                                        <tr>
                                          <th>SL. No</th>
                                          <th>Tax Payer Name</th>
                                          <th>BIN No.</th>
                                          <th>E-TIN</th>
                                          <th>Contact No.</th>
                                          <th>Actions</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr *ngFor="let taxpayer of taxPayerList; let i = index">
                                          <td id="slid">{{ i + 1 }}</td>
                                          <td>{{taxpayer.taxPayerName}}</td>
                                          <td>{{taxpayer.binNo}}</td>
                                          <td>{{taxpayer.etinNo}}</td>
                                          <td>{{taxpayer.mobileNo}}</td>
                                          <td>Action</td>
                                        </tr>

                                      </tbody>
                                    </table>





                                  </div>


                                  <ng-template #noData>
                                    <p>No taxpayer data available.</p>
                                  </ng-template>

                                </div>

                              </div>

                            </div>

                          </div>

                        </div>
                      </div>
                    </div>


                  </div>





                </div>

              </div>



            </div>





          </div>





        </div>

      </div>
    </div>
  </div>



</div>